syntax = "proto3";

package zafran.starlark;

option go_package = "zafran.io/collection/clients/interfaces/genericimport";

import "google/protobuf/timestamp.proto";

// Enum definitions
enum IdentifierType {
  IDENTIFIER_TYPE_UNSPECIFIED = 0;
  AWS_EC2_INSTANCE_ID = 1;
  AZURE_VM_ID = 2;
  AZURE_RESOURCE_ID = 3;
  AZURE_AD_DEVICE_ID = 4;
  WINDOWS_CS_UUID = 5;
  LINUX_UUID = 6;
  SERIAL_NUMBER = 7;
  TENABLE_UUID = 8;
  CROWDSTRIKE_AID = 9;
}

enum InstancePropertyType {
  INSTANCE_PROPERTY_TYPE_UNSPECIFIED = 0;
  STRING = 1;
  INT = 2;
  FLOAT = 3;
  BOOL = 4;
  DATETIME = 5;
}

enum ComponentType {
  COMPONENT_TYPE_UNSPECIFIED = 0;
  APPLICATION = 1;
  CONTAINER = 2;
  CRYPTOGRAPHIC_ASSET = 3;
  DATA = 4;
  DEVICE = 5;
  DEVICE_DRIVER = 6;
  FILE = 7;
  FIRMWARE = 8;
  FRAMEWORK = 9;
  LIBRARY = 10;
  MACHINE_LEARNING_MODEL = 11;
  OPERATING_SYSTEM = 12;
  PLATFORM = 13;
}

enum InstanceType {
  INSTANCE_TYPE_UNKNOWN = 0;
  INSTANCE_TYPE_MACHINE = 1;
  INSTANCE_TYPE_CONTAINER_IMAGE = 2;
  INSTANCE_TYPE_SERVERLESS = 3;
  INSTANCE_TYPE_MOBILE_DEVICE = 4;
  INSTANCE_TYPE_NETWORK_DEVICE = 5;
  INSTANCE_TYPE_OT_IOT_DEVICE = 6;
  INSTANCE_TYPE_DATA_STORE = 7;
  INSTANCE_TYPE_CODE_PROJECT = 8;
  INSTANCE_TYPE_WEB_APP_API = 9;
}

// Instance data structures
message InstanceIdentifier {
  IdentifierType key = 1;
  string value = 2;
}

message InstancePropertyValue {
  string value = 1;
  InstancePropertyType type = 2;
  repeated string values = 3;
}

message AssetInstanceInformation {
  repeated string ip_addresses = 1;
  repeated string mac_addresses = 2;
}

message InetEvidence {
  google.protobuf.Timestamp first_seen = 1;
  google.protobuf.Timestamp last_seen = 2;
  string evidence_string = 3;
}

message InstanceTagKeyValue {
  string key = 1;
  string value = 2;
}

message InstanceLabel {
  string label = 1;
}

message InstanceTag {
  oneof tag {
    InstanceTagKeyValue key_value = 1;
    InstanceLabel label = 2;
  }
}

message InstanceData {
  string instance_id = 1;
  string name = 2;
  AssetInstanceInformation asset_information = 3;
  string operating_system = 4;
  repeated InstanceIdentifier identifiers = 5;
  map<string, InstancePropertyValue> instance_properties = 6;
  InetEvidence inet_evidence = 7;
  repeated InstanceTag tags = 8 [deprecated = true];
  google.protobuf.Timestamp source_last_seen = 9;
  repeated SBOMComponent sbom_components = 10;
  repeated InstanceLabel labels = 11;
  repeated InstanceTagKeyValue key_value_tags = 12;
  InstanceType instance_type = 13;
}

// SBOM Component for standalone software inventory
message SBOMComponent {
  Component component = 1;
  repeated string file_paths = 2;
}

// Vulnerability data structures
message Component {
  ComponentType type = 1;
  string product = 2;
  string vendor = 3;
  string version = 4;
  string display_name = 5;
}

message Remediation {
  string suggestion = 1;
  string source = 2;
  string fixed_in_version = 3; // Version in which the vulnerability is fixed
}

message CVSS {
  string version = 1;
  string vector = 2;
  double base_score = 3;
  string source = 4; // Source of the CVSS score (e.g., "nvd", "vendor")
  string type = 5; // Type of CVSS (e.g., "primary", "secondary")
}

message Vulnerability {
  string instance_id = 1;
  string cve = 2;
  bool in_runtime = 3;
  Component component = 4;
  Remediation remediation = 5;
  repeated CVSS CVSS = 6;
  repeated int64 cwe_ids = 7;
  string description = 8;
  google.protobuf.Timestamp first_observed = 9;
  google.protobuf.Timestamp last_observed = 10;
  repeated string file_paths = 11;
  // ScannerSource fields
  string scanner_id = 12; // Original finding ID from the scanner (e.g., "QID-86516")
  string external_url = 13; // URL to the finding in the scanner
  string references_url = 14; // Reference URL for the vulnerability
  string scanner_name = 15; // Name/title from the scanner
  // Additional metadata
  string severity = 16; // Severity level (e.g., "critical", "high", "medium", "low")
}
